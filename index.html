<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RDW Admin - Firebase</title>

  <!-- Firebase SDK -->
       <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
     <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
     <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
     
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
    import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

    // ðŸ”§ Ganti dengan config kamu dari Firebase Console
const firebaseConfig = {
  apiKey: "AIzaSyAya-7QEtbflW7jh_EoPclFBQ43VnrKZrM",
  authDomain: "rdw-katalog.firebaseapp.com",
  databaseURL: "https://rdw-katalog-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rdw-katalog",
  storageBucket: "rdw-katalog.firebasestorage.app",
  messagingSenderId: "506572005524",
  appId: "1:506572005524:web:43b7d27f2c33a1d4071481",
  measurementId: "G-BDQXKFERCR"
};

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);

    const productsList = document.getElementById("products-list");
    const form = document.getElementById("product-form");
    const nameInput = document.getElementById("product-name");
    const descInput = document.getElementById("product-description");
    const altInput = document.getElementById("product-alt");
    const imageInput = document.getElementById("product-image");
    const submitBtn = document.getElementById("submit-btn");
    const visitsCount = document.getElementById("visits-count");

    // Tambah produk
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.textContent = "Mengunggah...";

      const name = nameInput.value.trim();
      const description = descInput.value.trim();
      const alt = altInput.value.trim();
      const file = imageInput.files[0];

      if (!file || !name || !description || !alt) {
        alert("Lengkapi semua data dan gambar!");
        submitBtn.disabled = false;
        submitBtn.textContent = "Tambah Produk";
        return;
      }

      try {
        const imgRef = sRef(storage, "images/" + Date.now() + "-" + file.name);
        const snap = await uploadBytes(imgRef, file);
        const imgUrl = await getDownloadURL(snap.ref);

        const newRef = push(ref(db, "products"));
        await set(newRef, {
          name,
          description,
          alt,
          image: imgUrl
        });

        form.reset();
        alert("Produk berhasil ditambahkan!");
      } catch (err) {
        alert("Gagal upload: " + err.message);
      }

      submitBtn.disabled = false;
      submitBtn.textContent = "Tambah Produk";
    });

    // Tampilkan produk
    const loadProducts = () => {
      const productRef = ref(db, "products");
      onValue(productRef, (snapshot) => {
        productsList.innerHTML = "";
        const data = snapshot.val();
        if (!data) {
          productsList.innerHTML = "<p>Tidak ada produk</p>";
          return;
        }
        Object.entries(data).forEach(([id, prod]) => {
          const el = document.createElement("div");
          el.className = "product-item";
          el.innerHTML = `
            <img src="${prod.image}" alt="${prod.alt}" class="product-thumb" />
            <div class="product-info">
              <h3>${prod.name}</h3>
              <p>${prod.description.split("\n")[0]}</p>
            </div>
            <div class="product-actions">
              <button class="btn-delete" data-id="${id}">Hapus</button>
            </div>
          `;
          el.querySelector(".btn-delete").onclick = () => {
            if (confirm("Hapus produk ini?")) {
              remove(ref(db, "products/" + id));
            }
          };
          productsList.appendChild(el);
        });
      });
    };

    // Statistik kunjungan sederhana
    const addVisit = async () => {
      const statsRef = ref(db, "stats/visits");
      onValue(statsRef, (snap) => {
        const v = snap.val() || 0;
        set(ref(db, "stats/visits"), v + 1);
        visitsCount.textContent = "Jumlah Pengunjung Website Saat Ini: " + (v + 1);
      });
    };

    loadProducts();
    addVisit();
  </script>

  <style>
    /* copy-kan style CSS kamu di sini seperti sebelumnya */
  </style>
</head>
<body>
  <header>RDW Admin Panel</header>
  <main>
    <h1>Kelola Produk & Statistik Kunjungan</h1>
    <div class="stat-box" id="visits-count">Menghitung pengunjung...</div>

    <form id="product-form">
      <label>Nama Produk</label>
      <input type="text" id="product-name" required />
      <label>Deskripsi Produk</label>
      <textarea id="product-description" required></textarea>
      <label>Alt Text Gambar</label>
      <input type="text" id="product-alt" required />
      <label>Upload Gambar (max 2MB)</label>
      <input type="file" id="product-image" accept="image/*" required />
      <button type="submit" id="submit-btn">Tambah Produk</button>
    </form>

    <section class="products-list" id="products-list" aria-live="polite"></section>
  </main>
</body>
</html>
